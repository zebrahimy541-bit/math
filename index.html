<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ماشین حساب ریاضی با رادیکال</title>
    <style>
        body {
            font-family: Tahoma, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background-color: #f0f0f0;
        }
        .calculator {
            background-color: #fff;
            border-radius: 15px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
            padding: 20px;
            width: 350px;
        }
        #screen {
            width: 100%;
            height: 60px;
            background-color: #eee;
            border: none;
            border-radius: 8px;
            margin-bottom: 15px;
            padding: 0 15px;
            font-size: 1.5em;
            text-align: right;
            box-sizing: border-box;
        }
        .buttons {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
        }
        button {
            padding: 15px;
            font-size: 1.2em;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        button:hover {
            opacity: 0.9;
        }
        .operator {
            background-color: #ff9500;
            color: white;
        }
        .number, .dot {
            background-color: #d4d4d2;
        }
        .function {
            background-color: #a6a6a6;
        }
        #equals {
            grid-column: span 2;
            background-color: #007aff;
            color: white;
        }
        #result-area {
            margin-top: 20px;
            padding: 10px;
            border-top: 1px solid #ccc;
            font-size: 1.1em;
            white-space: pre-wrap;
            text-align: right;
        }
    </style>
</head>
<body>

<div class="calculator">
    <input type="text" id="screen" value="" placeholder="عبارت ریاضی...">
    <div class="buttons">
        <button class="function" onclick="appendInput('√')">√</button>
        <button class="function" onclick="appendInput('^')">^</button>
        <button class="function" onclick="clearScreen()">C</button>
        <button class="operator" onclick="appendInput('/')">/</button>

        <button class="number" onclick="appendInput('7')">7</button>
        <button class="number" onclick="appendInput('8')">8</button>
        <button class="number" onclick="appendInput('9')">9</button>
        <button class="operator" onclick="appendInput('*')">×</button>

        <button class="number" onclick="appendInput('4')">4</button>
        <button class="number" onclick="appendInput('5')">5</button>
        <button class="number" onclick="appendInput('6')">6</button>
        <button class="operator" onclick="appendInput('-')">-</button>

        <button class="number" onclick="appendInput('1')">1</button>
        <button class="number" onclick="appendInput('2')">2</button>
        <button class="number" onclick="appendInput('3')">3</button>
        <button class="operator" onclick="appendInput('+')">+</button>

        <button class="function" onclick="appendInput('(')">(</button>
        <button class="number" onclick="appendInput('0')">0</button>
        <button class="function" onclick="appendInput(')')">)</button>
        <button id="equals" onclick="identify()">=</button>
    </div>
    <div id="result-area"></div>
</div>

<script>
    const screenInput = document.getElementById('screen');
    const resultArea = document.getElementById('result-area');

    function appendInput(value) {
        screenInput.value += value;
    }

    function clearScreen() {
        screenInput.value = '';
        resultArea.innerHTML = '';
    }

    /**
     * تبدیل نمادهای ریاضی به توابع قابل اجرای جاوااسکریپت
     * - √ -> Math.sqrt()
     * - ^ -> Math.pow()
     * @param {string} expr - عبارت ورودی از صفحه
     * @returns {string} - عبارت تبدیل شده برای eval
     */
    function convertRadicals(expr) {
        let convertedExpr = expr;

        // 1. مدیریت توان (^) به Math.pow(base, exponent)
        // این الگو به دنبال X^Y است که X و Y می‌توانند اعداد یا عبارت‌های داخل پرانتز باشند.
        // برای سادگی و جلوگیری از پیچیدگی بیش از حد پارس کردن در یک خط، ابتدا توان‌ها را مدیریت می‌کنیم
        // اما این روش همچنان مستعد خطاست. برای رفع مشکل شما، تمرکز بر روی رادیکال می‌گذاریم.

        // الگوی رادیکال اصلاح شده: به دنبال √X^Y یا √(X^Y) یا √X
        // ما فرض می‌کنیم که کاربر ورودی را به شکل (√A)^B یا √(A^B) وارد کرده است.

        // A. حالت (√A)^B (رادیکال ابتدا، سپس توان):
        // این حالت را به صورت (Math.pow(Math.sqrt(A), B)) ترجمه می‌کنیم.
        convertedExpr = convertedExpr.replace(/\(\s*√\s*([0-9.]+)\s*\)\s*\^\s*([0-9.]+)\s*/g, (match, base, exponent) => {
            return `Math.pow(Math.sqrt(${base}), ${exponent})`;
        });

        // B. حالت √(A^B) (ترکیب ساده داخل رادیکال):
        // اگر توان داخل رادیکال باشد، ابتدا آن را محاسبه می‌کنیم.
        convertedExpr = convertedExpr.replace(/√\s*\(\s*([0-9.]+)\s*\^\s*([0-9.]+)\s*\)/g, (match, base, exponent) => {
            // ابتدا توان داخل را محاسبه می‌کنیم، سپس رادیکال آن را می‌گیریم.
            return `Math.sqrt(Math.pow(${base}, ${exponent}))`;
        });

        // C. حالت ساده √X^Y (که مشکل اصلی شما بود)
        // اگر ورودی به صورت "√9^2" باشد، پارسر استاندارد جاوااسکریپت ممکن است آن را به درستی نفهمد.
        // ما آن را به قوی‌ترین شکل ممکن یعنی (√A)^B یا √(A^B) ترجمه می‌کنیم.
        // اگر کاربر "√9^2" را وارد کرده، ما فرض می‌کنیم منظور √ (9^2) بوده است.
        convertedExpr = convertedExpr.replace(/√\s*([0-9.]+)\s*\^\s*([0-9.]+)/g, (match, base, exponent) => {
             // تبدیل به √(base^exponent)
            return `Math.sqrt(Math.pow(${base}, ${exponent}))`;
        });

        // D. رادیکال ساده: √X
        convertedExpr = convertedExpr.replace(/√\s*([0-9.]+)/g, (match, base) => {
            return `Math.sqrt(${base})`;
        });

        // 2. تبدیل نماد توان به Math.pow برای عبارات باقیمانده
        // این تبدیل باید پس از رادیکال انجام شود تا ترتیب درستی حفظ شود.
        // این الگو فقط برای توان‌های ساده‌ای که در بالا مدیریت نشده‌اند کاربرد دارد.
        convertedExpr = convertedExpr.replace(/([0-9.]+)\s*\^\s*([0-9.]+)/g, (match, base, exponent) => {
            // اگر base یک تابع Math (مثل Math.sqrt) نباشد، آن را تبدیل کن
            if (!match.includes('Math.sqrt')) {
                 return `Math.pow(${base}, ${exponent})`;
            }
            return match; // اگر قبلاً با رادیکال ترکیب شده، تغییر نده
        });

        // جایگزینی ^ با Math.pow در حالتی که به صورت (X)^Y باشد و در بالا پوشش داده نشده
        convertedExpr = convertedExpr.replace(/Math.pow\(([^)]+)\)\s*\^\s*([0-9.]+)/g, (match, base, exponent) => {
            // جلوگیری از تبدیل تودرتوی نامناسب
            return match;
        });


        return convertedExpr;
    }


    /**
     * شناسایی و دسته‌بندی عدد محاسبه شده
     * @param {number} num - عدد نتیجه
     */
    function identify(num) {
        let categories = [];
        if (Number.isInteger(num) && num >= 0) {
            categories.push("طبیعی (Natural)");
        }
        if (Number.isInteger(num)) {
            categories.push("صحیح (Integer)");
        }
        if (Number.isFinite(num) && (num % 1 === 0 || num % 1 !== 0)) {
            categories.push("گویا (Rational)");
        }
        if (Number.isFinite(num)) {
            categories.push("حقیقی (Real)");
        }

        const categoryStr = categories.join(", ");
        return `نوع عدد: ${categoryStr}`;
    }

    function identify() {
        let expression = screenInput.value.trim();
        if (!expression) {
            resultArea.innerHTML = "لطفاً عبارتی وارد کنید.";
            return;
        }

        // تبدیل نمادها به توابع جاوااسکریپت
        let jsExpression = convertRadicals(expression);

        // افزودن پرانتز برای اطمینان از اولویت اگر ورودی فقط یک عدد باشد
        if (!isNaN(parseFloat(expression)) && isFinite(expression)) {
             jsExpression = expression;
        }


        let finalResult;
        try {
            // استفاده از eval برای محاسبه نهایی
            // این کار ممکن است خطرناک باشد، اما در محیط کنترل شده ماشین حساب داخلی امن است.
            finalResult = eval(jsExpression);

            if (typeof finalResult === 'number' && isFinite(finalResult)) {
                const classification = identify(finalResult);
                resultArea.innerHTML = `مقدار نهایی: ${finalResult.toFixed(1)}\n${classification}`;
            } else {
                resultArea.innerHTML = "خطا در محاسبه یا نتیجه نامعتبر است.";
            }
        } catch (error) {
            resultArea.innerHTML = `خطای محاسباتی: ${error.message}\nعبارت تبدیل شده: ${jsExpression}`;
        }
    }
</script>

</body>
</html>
